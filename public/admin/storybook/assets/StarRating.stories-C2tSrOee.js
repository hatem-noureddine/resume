import{r as o,j as g}from"./iframe-Co86Tdbj.js";import{c as D}from"./utils-CDN07tui.js";import{u as L}from"./usePrefersReducedMotion-DsEbz-gQ.js";import{m as J}from"./proxy-DLierJoI.js";import{c as T}from"./createLucideIcon-DMHoXgSb.js";import{A as _}from"./index-B7VEVbfo.js";import"./preload-helper-PPVm8Dsz.js";const U=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],K=T("star",U);function V(){return typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`user_${Date.now().toString(36)}_${Math.floor(performance.now()).toString(36)}`}function q(I,y={}){const{storageKey:h="blog-ratings",maxRating:R=5,initialRating:r=0}=y,[O,v]=o.useState(r),[b,m]=o.useState(!1),[N,d]=o.useState(r||0),[w,n]=o.useState(r?1:0),[x,C]=o.useState(null),S=`${h}-guest-id`,i=`${h}-user-${I}`,l=`${h}-aggregate-${I}`;o.useEffect(()=>{if(globalThis.window!==void 0)try{let s=localStorage.getItem(S);s||(s=V(),localStorage.setItem(S,s)),C(s);const c=localStorage.getItem(i);if(c){const a=JSON.parse(c);a.guestId===s&&(v(a.rating),m(!0))}const t=localStorage.getItem(l);if(t){const{sum:a,count:e}=JSON.parse(t);d(e>0?a/e:0),n(e)}else r>0&&(d(r),n(1))}catch(s){console.error("Error initializing rating:",s)}},[i,l,S,r]);const z=o.useCallback(s=>{if(globalThis.window===void 0||!x)return;const c=Math.max(1,Math.min(s,R));try{const t=localStorage.getItem(l);let a=0,e=0;if(t){const u=JSON.parse(t);a=u.sum,e=u.count}else r>0&&(a=r,e=1);const p=localStorage.getItem(i);if(p){const u=JSON.parse(p);a-=u.rating}else e+=1;a+=c;const f={rating:c,timestamp:new Date().toISOString(),guestId:x};localStorage.setItem(i,JSON.stringify(f)),localStorage.setItem(l,JSON.stringify({sum:a,count:e})),v(c),m(!0),d(e>0?a/e:0),n(e)}catch(t){console.error("Error saving rating:",t)}},[i,l,R,x,r]),E=o.useCallback(()=>{if(globalThis.window!==void 0)try{const s=localStorage.getItem(i);if(s){const c=JSON.parse(s),t=localStorage.getItem(l);if(t){const{sum:a,count:e}=JSON.parse(t),p=a-c.rating,f=e-1;f>0?(localStorage.setItem(l,JSON.stringify({sum:p,count:f})),d(p/f),n(f)):(localStorage.removeItem(l),d(r||0),n(r?1:0))}localStorage.removeItem(i)}v(0),m(!1)}catch(s){console.error("Error resetting rating:",s)}},[i,l,r]);return{rating:O,setRating:z,hasRated:b,averageRating:N,totalRatings:w,resetRating:E,guestId:x}}const H={sm:"w-4 h-4",md:"w-5 h-5",lg:"w-6 h-6"},F={sm:"gap-0.5",md:"gap-1",lg:"gap-1.5"};function $({postSlug:I,maxStars:y=5,size:h="md",showCount:R=!0,showAverage:r=!0,className:O,initialRating:v=0}){const{rating:b,setRating:m,hasRated:N,averageRating:d,totalRatings:w}=q(I,{maxRating:y,initialRating:v}),n=L(),[x,C]=o.useState(0),[S,i]=o.useState(!1),l=o.useCallback(t=>{m(t)},[m]),z=o.useCallback(t=>{i(!0),C(t)},[]),E=o.useCallback(()=>{i(!1),C(0)},[]),s=o.useCallback((t,a)=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),m(a))},[m]),c=S?x:b;return g.jsxs("div",{className:D("flex flex-col gap-2",O),children:[g.jsx("fieldset",{className:D("flex items-center p-0 border-none m-0",F[h]),onMouseLeave:E,"aria-label":"Rate this article",children:Array.from({length:y},(t,a)=>{const e=a+1,p=e<=c,f=!p&&e<=Math.ceil(d)&&!N&&!S;let u;return p?u="fill-amber-400 text-amber-400":f?u="fill-amber-400/30 text-amber-400/50":u="fill-transparent text-muted-foreground/50 hover:text-amber-400/70",g.jsx(J.button,{type:"button",onClick:()=>l(e),onMouseEnter:()=>z(e),onKeyDown:A=>s(A,e),className:D("relative focus:outline-none focus:ring-2 focus:ring-primary/50 rounded transition-transform",S&&"cursor-pointer",!n&&"hover:scale-110"),whileHover:n?{}:{scale:1.2},whileTap:n?{}:{scale:.9},"aria-label":`Rate ${e} out of ${y} stars`,"aria-pressed":b===e,children:g.jsx(K,{className:D(H[h],"transition-colors duration-200",u)})},e)})}),g.jsx(_,{mode:"wait",children:(r||R)&&w>0&&g.jsxs(J.div,{initial:n?{}:{opacity:0,y:-5},animate:{opacity:1,y:0},exit:n?{}:{opacity:0,y:-5},className:"flex items-center gap-2 text-xs text-muted-foreground",children:[r&&g.jsx("span",{className:"font-medium",children:d.toFixed(1)}),R&&g.jsxs("span",{children:["(",w," ",w===1?"rating":"ratings",")"]})]})}),g.jsx(_,{children:N&&g.jsx(J.p,{initial:n?{}:{opacity:0,y:5},animate:{opacity:1,y:0},exit:n?{}:{opacity:0,y:5},className:"text-xs text-primary font-medium",children:"Thanks for rating!"})})]})}$.__docgenInfo={description:`Star Rating component for blog posts.
Displays interactive 5-star rating with localStorage persistence.`,methods:[],displayName:"StarRating",props:{maxStars:{defaultValue:{value:"5",computed:!1},required:!1},size:{defaultValue:{value:'"md"',computed:!1},required:!1},showCount:{defaultValue:{value:"true",computed:!1},required:!1},showAverage:{defaultValue:{value:"true",computed:!1},required:!1},initialRating:{defaultValue:{value:"0",computed:!1},required:!1}}};const Z={title:"UI/StarRating",component:$,tags:["autodocs"],parameters:{layout:"centered"},argTypes:{size:{control:"select",options:["sm","md","lg"]}}},j={args:{postSlug:"demo-post",maxStars:5,size:"md",showCount:!0,showAverage:!0,initialRating:0}},k={args:{postSlug:"demo-post-lg",maxStars:5,size:"lg",initialRating:4}},M={args:{postSlug:"demo-post-sm",maxStars:5,size:"sm",showCount:!1,showAverage:!1,initialRating:3}};j.parameters={...j.parameters,docs:{...j.parameters?.docs,source:{originalSource:`{
  args: {
    postSlug: 'demo-post',
    maxStars: 5,
    size: 'md',
    showCount: true,
    showAverage: true,
    initialRating: 0
  }
}`,...j.parameters?.docs?.source}}};k.parameters={...k.parameters,docs:{...k.parameters?.docs,source:{originalSource:`{
  args: {
    postSlug: 'demo-post-lg',
    maxStars: 5,
    size: 'lg',
    initialRating: 4
  }
}`,...k.parameters?.docs?.source}}};M.parameters={...M.parameters,docs:{...M.parameters?.docs,source:{originalSource:`{
  args: {
    postSlug: 'demo-post-sm',
    maxStars: 5,
    size: 'sm',
    showCount: false,
    showAverage: false,
    initialRating: 3
  }
}`,...M.parameters?.docs?.source}}};const ee=["Default","Large","SmallNoStats"];export{j as Default,k as Large,M as SmallNoStats,ee as __namedExportsOrder,Z as default};
